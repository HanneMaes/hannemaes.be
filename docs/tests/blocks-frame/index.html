<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <title>Quartz Genesis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="img/favicon.ico" />

<!-- ****************************************************************************************************************************** -->
<!-- CSS -->
<style>

    html, body { 
        padding: 0;
        margin: 0;
        font-family: monospace;
        scroll-behavior: smooth;
    }
    
    body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }


    .logo {
        height: 70px;
        max-width: 100%;
        padding-top:    30px;
        padding-bottom: 30px;
    }

    a {
        text-decoration: none;
        opacity: 0.3;
        transition: 0.5s;
        color: black;
    }
    a:hover {
        opacity: 1;
    }

    /* popup styling */
    a {
        padding-top: 10px; /* distance of the popup */
    }

    .tippy-content {
        text-align: center;
        padding: 15px;
        padding-bottom: 10px;
    }

    .artContainer {
        /* height: 100vh; */

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* iframe */
    iframe {
        overflow: hidden; /* remove scrollbars */
        height: 1600px;
        width: 900px;
        border-radius: 10px;
        border: none;
        overflow: hidden; /* remove scrollbars */
    }

    /* UI */
    .ui img {
        width: 20px;
        height: 20px;
    }

    .hidden {
        display: none;
    }

    /* dark and light mode effect */
    .frame-dark  { box-shadow: 0 50px 130px rgba(0, 0, 0, 1); }
    .frame-light { box-shadow: 0 40px 70px rgba(0, 0, 0, 0.3); }

    .body-dark  { background-color: #222222; }
    .body-light { background-color: #ffffff; }

    .infoText-dark { color: rgba(255, 255, 255, 0.5); }
    .infoText-dark em { color: white; }
    .infoText-dark a { color: white; }
    .infoText-light { color: rgba(0, 0, 0, 0.5); }
    .infoText-light em { color: black; }
    .infoText-light a { color: black; }

    /* info */
    .info {
        width: 70vw;
        max-width: 1000px;
    }

    .infoText {
        line-height: 20px;
    }

    ul {
        list-style-type: "- ";
    }

    em {
        font-style: normal;
    }

    .spacing {
        margin-bottom: 100px;
    }

    /* tooltip */ /* https://blog.logrocket.com/creating-beautiful-tooltips-with-only-css/ */
    .tooltip {
        position: relative; /* making the .tooltip span a container for the tooltip text */
    }
    
    .tooltip:before {
        content: attr(tooltip); /* here's the magic */
        position: absolute;

        background-color: black;
        color: white;
        
        /* positioning */
        bottom: 30px;
        left:100%;
        margin-left:10px; /* Adjusted left margin */ 
        width:120px;
        padding:10px; /* Increased padding for better readability */ 
        border-radius:3px; /* Slightly rounded corners */ 
        text-align:center;

        /* hide by default */
        /*display:none; /* hide by default */
    }

    .tooltip:hover:before { /* show on hover */
        display: inline-block;
    }

    </style>

    <!-- tooltip library -->
    <link rel="stylesheet" href="path/to/tippy.css">
    <script src="path/to/tippy-bundle.umd.js"></script>

</head>

<!-- ****************************************************************************************************************************** -->
<!-- HTML -->
<body>

    <div class="spacing"></div> <!-- spacing: created a div to let it not be visible in the screenshot -->

    <!-- artwork -->
    <iframe id="iframe" src="raw.html"></iframe>

    <!-- info & ui -->
    <section id="infoId" class="info">
        
        <div class="spacing"></div> <!-- spacing: created a div to let it not be visible in the screenshot -->

        <!-- UI -->
        <div class="ui"><!-- icons from https://remixicon.com/ -->

            <!-- dark / light mode -->
            <a id="switch-light" href="index.html?mode=dark&ui=true"><img src="img/icons/moon-dark.svg" alt="Dark mode"/></a>
            <a id="switch-dark" href="index.html?mode=light&ui=true"><img src="img/icons/sunny-light.svg" alt="Light mode"/></a>

            <!-- screenshot -->
            <a id="screenshotButtonLight" class="camera-light" href="#"><img src="img/icons/camera-dark.svg" alt="Take screenshot"/></a>
            <a id="screenshotButtonDark" class="camera-dark" href="index.html?mode=light&ui=true&screenshot=true"><img src="img/icons/camera-light.svg" alt="Take screenshot"/></a><!-- the dark mode screenshot isnt working, so I switchto light mode and immediately take a screenshot-->

            <!-- hide UI -->
            <a id="x-light" href="index.html?mode=light&ui=false"><img src="img/icons/close-dark.svg" alt="Show only the artwork"/></a>
            <a id="x-dark" href="index.html?mode=dark&ui=false"><img src="img/icons/close-light.svg" alt="Show only the artwork"/></a>

        </div>
            
        <!-- INFO -->
        <div id="screenshotInfo">
            <img class="logo" id="logo-light" src="img/Quartz genesis - dark.svg">
            <img class="logo" id="logo-dark" src="img/Quartz genesis - light.svg">
            <div class="infoText">
                Over the past 4 years, I've worked on and off on this project, learning and experimenting in between other projects. I'm excited that it's finally finished and is now ready for its next phase.<br>
                <br>
                Quartz Genesis is a <em>time-based</em> artwork, consisting of 3 layers:
                <ul>
                    <li>The background changes every 1:30 hours and has 14 variants.</li>
                    <li>The character changes every hour with 24 variations.</li>
                    <li>The lines have 8 variants, changing every 45 minutes, and shifts colors every 15 minutes among 3 different colors.</li>
                </ul>
                The <em>background and lines are consistent for viewers all around the world</em>, creating a shared experience. However, the <em>character layer is personalized based on your timezone</em>, connecting the artwork to your surroundings.<br>
                With a narrow 15-minute time window before changes occur, the likelihood of seeing the exact same composition again is rare. This ensures that each composition is fleeting and makes <em>encountering the same configuration a rare event</em>.<br>
                Beauty is not only in visuals but also in its connection to the present moment.<br>
                <br>
                Created using Blender and Midjourney.
                <br>
                Raw version: <a href="https://www.hannemaes.com/persistent/quartz/01/raw.html" target="_blank">https://www.hannemaes.com/persistent/quartz/01/raw.html</a><br>
                Arweave: <a href="https://lpcq3tjpad4qxjc2c2w4sejl5dohtnrqjwf4b5n5ajh2meqi4laq.arweave.net/W8UNzS8A-QukWhatyREr6Nx5tjBNi8D1vQJPphII4sE/" target="_blank">https://lpcq3tjpad4qxjc2c2w4sejl5dohtnrqjwf4b5n5ajh2meqi4laq.arweave.net/W8UNzS8A-QukWhatyREr6Nx5tjBNi8D1vQJPphII4sE/</a>
            </div>
        </div>
    </section>

    <div class="spacing"></div> <!-- spacing: created a div to let it not be visible in the screenshot -->

<!-- ****************************************************************************************************************************** -->

<!-- tooltips: https://atomiks.github.io/ -->
<script src="../lib/tippy-js/popper.min.js"></script>
<script src="../lib/tippy-js/tippy-bundle.umd.min.js"></script>
<script>
    // With the above scripts loaded, you can call `tippy()` with a CSS
    // selector and a `content` prop:

    tippy('#switch-light', { content: 'Switch to dark mode',  arrow: false });
    tippy('#switch-dark', {  content: 'Switch to light mode', arrow: false, theme: 'light' });

    tippy('.camera-light', { content: 'Take a screenshot of the work at this point in time', arrow: false });
    tippy('.camera-dark', {  content: 'Take a screenshot of the work at this point in time', arrow: false, theme: 'light' });

    tippy('#x-light', { content: 'Show only the artwork', arrow: false });
    tippy('#x-dark', {  content: 'Show only the artwork', arrow: false, theme: 'light' });
</script>

<!-- Screenshot lib -->
<script src="../lib/html2canvas.min.js"></script>


<!-- JS -->
<script>

    /***********************/
    /* dark of light mode? */
    /***********************/

    var mode = getUrlParameterByName('mode');
    var body = document.body
    var iframeContainer = document.getElementById('iframe');
    var switchDarkContainer = document.getElementById('switch-dark');
    var switchLightContainer = document.getElementById('switch-light'); 
    var cameraDarkContainer = document.querySelector('.camera-dark');   /* I use querySelector to find the class, because the id is used for the screenshot and an element can only have 1 id */
    var cameraLightContainer = document.querySelector('.camera-light'); /* I use querySelector to find the class, because the id is used for the screenshot and an element can only have 1 id */
    var xDarkContainer = document.getElementById('x-dark');
    var xLightContainer = document.getElementById('x-light');
    var logoDark = document.getElementById('logo-dark');
    var logoLight = document.getElementById('logo-light');
    var infoText = document.getElementById('infoId');

    // add/remove classes depending on mode, defaults to dark mode
    if (mode == 'dark') {
        body.classList.add('body-dark');               
        iframeContainer.classList.add('frame-dark'); 
        infoText.classList.add('infoText-dark')

        switchLightContainer.classList.add('hidden');     
        switchDarkContainer.classList.remove('hidden');

        cameraLightContainer.classList.add('hidden');     
        cameraDarkContainer.classList.remove('hidden');
        
        xLightContainer.classList.add('hidden');     
        xDarkContainer.classList.remove('hidden');

        logoLight.classList.add('hidden');     
        logoDark.classList.remove('hidden');
    } else {
        body.classList.add('body-light');                     
        iframeContainer.classList.add('frame-light');
        infoText.classList.add('infoText-light')

        switchDarkContainer.classList.add('hidden');     
        switchLightContainer.classList.remove('hidden'); 

        cameraDarkContainer.classList.add('hidden');     
        cameraLightContainer.classList.remove('hidden');

        xDarkContainer.classList.add('hidden');     
        xLightContainer.classList.remove('hidden'); 

        logoDark.classList.add('hidden');     
        logoLight.classList.remove('hidden');
    }

    // print
    console.log('Mode:', mode);
    
    /*************************/
    /* Show only the artwork */
    /*************************/

    var ui = getUrlParameterByName('ui');

    if (ui == 'false') {
        var uiContainer = document.getElementById('infoId');
        uiContainer.classList.add('hidden');  
    }
    
    // print
    console.log('UI:', ui);

    // functions ***********************************

    function getUrlParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    /*********************/
    /* Screenshot button */
    /*********************/
    
    document.getElementById('screenshotButtonLight').addEventListener('click', handleScreenshotButtonClick);
    // document.getElementById('screenshotButtonDark').addEventListener('click', handleScreenshotButtonClick);
    
    // for some reason the dark mode screenshot isn't working, so when clicking the button I switch to light mode and immeditaely take a screenshot
    var takeScreenshot = getUrlParameterByName('screenshot');
    console.log('takeScreenshot:', takeScreenshot);
    console.log();
    if (takeScreenshot) {  // if ndex.html?screenshot=true take screenshot

        // wait to make sure page is loaded and make a screenshot
        setTimeout(function() { 
            handleScreenshotButtonClick();
        }, 500);

        // remove 'screenshot=true' from the URL so we dont make anaother screenshot on reload
        let currentUrl = window.location.href; // Get the current URL
        let urlParams = new URLSearchParams(window.location.search); // Create a URLSearchParams object
        urlParams.delete('screenshot'); // Remove the 'screenshot' parameter
        let newUrl = `${window.location.origin}${window.location.pathname}?${urlParams.toString()}${window.location.hash}`; // Update the URL without the 'screenshot' parameter
        window.history.replaceState({}, document.title, newUrl); // Change the URL without reloading the page
    }
    

    // screenshot function
    function handleScreenshotButtonClick() {
        console.log('Take screenshot');
        
        // Settings
        var spacing = 40; // spacing between images     
        var bottomSpacing = 100; // spacing at the bottom of the image   

        // Image name
        var currentDate = new Date();
        var formattedDate = currentDate.toLocaleDateString();
        var formattedTime = currentDate.toLocaleTimeString();
        var imageName = 'Quartz at ' + formattedTime + ' ' + formattedDate + '.png';

        // Capture screenshot of the iframe
        var iframe = document.querySelector('iframe');
        var iframeCanvas = document.createElement('canvas');
        var iframeContext = iframeCanvas.getContext('2d');

        html2canvas(iframe.contentDocument.body).then(function(canvas) {
            iframeCanvas.width = canvas.width;
            iframeCanvas.height = canvas.height;
            iframeContext.drawImage(canvas, 0, 0);

            // Also capture screenshot of this element
            var infoElement = document.getElementById('screenshotInfo');
            var infoCanvas = document.createElement('canvas');
            var infoContext = infoCanvas.getContext('2d');

            html2canvas(infoElement).then(function(infoCanvas) {

                // Create a new canvas with the maximum width and combined height
                var maxWidth = Math.max(iframeCanvas.width, infoCanvas.width); // Determine the maximum width between the two elements
                var combinedCanvas = document.createElement('canvas');
                combinedCanvas.width = maxWidth;
                combinedCanvas.height = iframeCanvas.height + infoCanvas.height + spacing + bottomSpacing; // Add spacing between the images and at the bottom
                var combinedContext = combinedCanvas.getContext('2d');

                // Set the background color
                var bodyBackgroundColor = getComputedStyle(document.body).backgroundColor;
                combinedContext.fillStyle = bodyBackgroundColor;
                combinedContext.fillRect(0, 0, combinedCanvas.width, combinedCanvas.height);

                // Draw the iframe screenshot on the combined canvas at the top
                combinedContext.drawImage(iframeCanvas, (maxWidth - iframeCanvas.width) / 2, 0);

                // Draw the element with id "screenshotInfo" screenshot below the iframe screenshot with spacing
                combinedContext.drawImage(infoCanvas, (maxWidth - infoCanvas.width) / 2, iframeCanvas.height + spacing);

                // Convert the combined canvas to a data URL
                var combinedDataURL = combinedCanvas.toDataURL();

                // Create a link element to download the combined image
                var link = document.createElement('a');
                link.href = combinedDataURL;
                link.download = imageName;
                link.click();
            });
        });
    } // handleScreenshotButtonClick

    /*************************/
    /* Screenshot button RAW */
    /*************************/

    // document.getElementById('screenshotButton').addEventListener('click', function() {
        
    //     var iframe = document.querySelector('iframe'); // Find the only iframe on the page
    //     if (iframe) { // Check if an iframe is found

    //         // Image name
    //         var currentDate = new Date();
    //         var formattedDate = currentDate.toLocaleDateString();
    //         var formattedTime = currentDate.toLocaleTimeString();
    //         var imageName = 'A snapshot of Quartz at ' + formattedTime + ' ' + formattedDate;

    //         html2canvas(iframe.contentDocument.body).then(function(canvas) {
                
    //             var imageDataURL = canvas.toDataURL(); // Convert the canvas to a data URL

    //             // Create a link element to download the image
    //             var link = document.createElement('a');
    //             link.href = imageDataURL;
    //             link.download = imageName + '.png'; // You can specify the image format if needed
    //             link.click();
    //         });
    //     } else {
    //         console.error('No iframe found on the page.');
    //     }
    // });

</script>

</body>
</html>