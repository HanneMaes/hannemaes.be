<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">                                               <!-- defines the encoding of the website, utf-8 is the standard -->
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- viewport settings related to mobile responsiveness -->
    <!--
    The above 2 meta tags *must* come first in the <head>
    to consistently ensure proper document rendering.
    Any other head element should come *after* these tags.
    -->
    <meta width=device-width> <!-- use the physical width of the device (great for mobile!) -->
    <meta initial-scale=1>    <!-- the initial zoom, 1 means no zoom -->

    <title>V2.0</title>
    <meta name="application-name" content="HOUR 248"> <!-- Name of web application (only should be used if the website is used as an app) -->
    <meta name="theme-color" content="#000">

<!-- ****************************************************************************************************************************** -->
<!-- CSS -->
    <style>

        html, body { 
            padding: 0;
            margin: 0;
            overflow: hidden; /* remove scrollbars, this is needed to display this page in an iframe without scrollbars */
        }

    </style>
</head>

<!-- ****************************************************************************************************************************** -->
<!-- HTML -->
<body>
<canvas id="canvas">
    <!-- error message -->
    Your browser does not support the HTML5 canvas tag.
</canvas>
<script>
/***********************************************************************************************************************************/
// CANVAS

    // init 2D canvas
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    // resize the canvas when needed
    resizeCanvas(); // initial resize, setting the first size
    window.addEventListener("resize", resizeCanvas); // Add event listener for window resize

    function resizeCanvas() {
        if (window.innerWidth < window.innerHeight) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerWidth;
        } else {
            canvas.width = window.innerHeight;
            canvas.height = window.innerHeight;
        }

        // animation settings
        var refreshRateInSeconds = 1;

        var numberOfBgs   = 2;
        var numberOfSky   = 24;
        // var numberOfLines = 3;

        var prevBgImg   = 0;
        var prevSkyImg  = 0;
        // var prevLineImg = 0;

        // animation loop
        setInterval(draw, refreshRateInSeconds * 1000);

        // setInterval waits before executing its function, so call the function once when the page starts
        draw();
        function draw() {
                    // get time
                    var timeLocal = new Date();
            var timeEpoch = Date.now(); 

            /*********/
            /* BGS */// -> 1 per 30min (epoch time), mapped with modulo
            /*********/

            var epochMinutes = TimeEpochToMinutes(timeEpoch);
            var imgBg = Math.floor(epochMinutes / 30) % numberOfBgs; // change modulo to 30 minutes
                imgBg++ // imgBg++ because the modulo remaps to a base zero and my images start from 0001.png

            /*******/
            /* SKY */// -> 1 per hour (local time), 24 images
            /*******/

            var imgSky = timeLocal.getHours(); // timeLocal.getHours();

            /*********/
            /* LINES */// -> 1 per hour, mapped with modulo
            /*********/

            // var epochMinutes = TimeEpochToMinutes(timeEpoch);
            // var imgLines = epochMinutes % numberOfLines;
            //     imgLines++ // imgLines++ because the modulo remaps to a base zero and my images start from 0001.png

            /*********************************/
            /* only load images that changed */
            /*********************************/

            var redraw = false;

            if (imgBg != prevBgImg)   redraw = true;
            if (imgSky != prevSkyImg) redraw = true;
            prevBgImg = imgBg
            prevSkyImg = imgSky

            /**************************/
            /* DRAW if images changed */
            /**************************/

            if (redraw) {

                // clear canvas
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

                // draw BG
                var imgBgObject = new Image();
                    imgBgObject.src = "img/bg/" + leadingZeros(imgBg, 4) + ".png";
                    imgBgObject.onload = function() {
                        ctx.drawImage(imgBgObject, 0, 0, canvas.width, canvas.height);

                        // draw SKY
                        var imgSkyObject = new Image();
                            imgSkyObject.src = "img/sky/" + leadingZeros(imgSky, 4) + ".png";
                            imgSkyObject.onload = function() {
                                ctx.drawImage(imgSkyObject, 0, 0, canvas.width, canvas.height);

                                // draw LINES

                        } // imgSkyObject.onload
                    } // imgBgObject.onload

            } // if (redraw)

            // log
            if (redraw) {
                console.warn(" ")
                console.warn("Redraw:", redraw);
                console.warn("Bg (changes every 30min),", TimeEpochToHours(timeEpoch) + ":" + TimeEpochToMinutes(timeEpoch) + ":" + TimeEpochToSeconds(timeEpoch), "(epoch time): bg/" + imgBg + ".png");
                console.warn("Sky (changes every hour),", TimeLocalToReadable(timeLocal), "(local time): sky/" + imgSky + ".png");
            } else {
                console.log(" ")
                console.log("Redraw:", redraw);
                console.log("Bg (changes every 30min),", TimeEpochToHours(timeEpoch) + ":" + TimeEpochToMinutes(timeEpoch) + ":" + TimeEpochToSeconds(timeEpoch), "(epoch time): bg/" + imgBg + ".png");
                console.log("Sky (changes every hour),", TimeLocalToReadable(timeLocal), "(local time): sky/" + imgSky + ".png");
            }
        } // function draw()

    } // function resizeCanvas()

//***********************************
// HELPER FUNCTION

function TimeLocalToReadable (t) { return t.toLocaleTimeString('en-GB'); }
function TimeEpochToHours(t)     { return leadingZeros(new Date(t).getUTCHours(),   2); }
function TimeEpochToMinutes(t)   { return leadingZeros(new Date(t).getUTCMinutes(), 2); }
function TimeEpochToSeconds(t)   { return leadingZeros(new Date(t).getUTCSeconds(), 2); }

function leadingZeros(num, amountOfZeros) {
// amountOfZeros: if you want 02, amountOfZeros is 2, if you want 0002, amountOfZeros is 4, ...
    num = num.toString();
    while (num.length < amountOfZeros) num = "0" + num;
    return num;
}

/***********************************************************************************************************************************/
</script>
</body>
</html>